"use strict";!function(a,b){function c(){for(var c=0,d=b.querySelectorAll("[component]");c<d.length;c++){var f=d[c],g=f.attributes.component.value;"object"!=typeof s.modules[g]&&(s.modules[g]={}),"object"!=typeof s.rdom[g]&&Object.defineProperty(s.rdom,g,{value:f,writable:!0}),"object"!=typeof s.vdom[g]&&Object.defineProperty(s.vdom,g,{value:f.cloneNode(!0),writable:!1}),"object"!=typeof s.virtdom[g]&&Object.defineProperty(s.virtdom,g,{value:e().serialize(f),writable:!1}),s.component[g]&&"object"==typeof s.component[g]&&s.component[g].func.apply(this,q(s.component[g])),Object.modulesync(g,s.modules[g],function(b){s.queue[b]&&a.clearImmediate(s.queue[b]),a.setImmediate(function(){m(s.rdom[b],s.vdom[b],s.modules[b],s.virtdom[b])},300)}),m(s.rdom[g],s.vdom[g],s.modules[g],s.virtdom[g])}}function d(){var b,c,d=0,e=0,g={},h={},i={},j={},k=!1,l=[],m=function(a){return new Promise(function(b){a.before&&"function"==typeof a.before&&a.before.apply(this,[a]);var c=f(function(){this.onmessage=function(a){var b=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");b.onload=function(){postMessage({success:!0,type:"html",status:b.status,readyState:b.readyState,responseText:b.responseText,request:a.data})},b.onerror=function(){postMessage({success:!1,type:"html",status:b.status,readyState:b.readyState,responseText:b.responseText,request:a.data})},"withCredentials"in b?(b.withCredentials=!0,b.open(a.data.type,a.data.url+("GET"==a.data.type?a.data.params:""),!0)):"undefined"!=typeof XDomainRequest&&(b=new XDomainRequest,b.open(a.data.type,a.data.url)),~["PUT","DELETE","POST"].indexOf(a.data.type)&&b.setRequestHeader?(b.setRequestHeader("Content-type","application/x-www-form-urlencoded"),b.send(a.data.params)):b.send()}}).onmessage(function(d){b({req:a,res:d}),a.after&&"function"==typeof a.after&&a.after.apply(this,[d]),setImmediate(c.terminate)}).emit({url:a.url,params:a.params,type:a.type});l[l.length]=c})},n=function(a){Promise.all(function(){for(var b=0,c=[];b<h[a].length;b++)c[c.length]=m(h[a][b]);return c}()).then(function(b){k||(g[a]||(g[a]=[]),function(){for(var c=0;c<b.length;c++)g[a][c]=b[c];if(i[a]){j[a]&&"number"==typeof j[a]&&g[a].splice(j[a]),Array.prototype.each=function(a){if(a)for(var b=0;b<this.length;b++)a.apply(this,[this[b].res?this[b].res:this[b]])};for(var e=0;e<i[a].length;e++)i[a][e].apply(this,[g[a],g])}d>a&&n(a+1)}())})};return c={params:function(a,b){for(var c=0,d=b?"?":"",e=Object.keys(a);c<e.length;c++)d+=encodeURIComponent(e[c])+"="+encodeURIComponent(a[e[c]])+"&";return d.substring(0,d.length-1)},get:function(a,b){return h[d]||(h[d]=[]),h[d][h[d].length]={url:a,params:c.params((b?b.params:{})||b||{},!0),type:"GET",before:b?b.before:void 0,after:b?b.after:void 0},c},post:function(a,b){return h[d]||(h[d]=[]),h[d][h[d].length]={url:a,params:c.params((b?b.params:{})||b||{}),type:"POST",before:b?b.before:void 0,after:b?b.after:void 0},c},"delete":function(a,b){return h[d]||(h[d]=[]),h[d][h[d].length]={url:a,params:c.params((b?b.params:{})||b||{}),type:"DELETE",before:b?b.before:void 0,after:b?b.after:void 0},c},put:function(a,b){return h[d]||(h[d]=[]),h[d][h[d].length]={url:a,params:c.params((b?b.params:{})||b||{}),type:"PUT",before:b?b.before:void 0,after:b?b.after:void 0},c},run:function(){return d++,b&&a.clearImmediate(b),b=a.setImmediate(function(){n(e)}),c},then:function(a){return i[d-1]||(i[d-1]=[]),i[d-1][i[d-1].length]=a,c},json:function(){return i[d-1]||(i[d-1]=[]),i[d-1][i[d-1].length]=function(a){for(var b=0;b<a.length;b++){var c=a[b].res;try{var d=JSON.parse(c.responseText);c.responseText=d,c.type="json"}catch(e){}}},c},clear:function(){return d=0,e=0,g={},h={},i={},j={},c},limit:function(a){return j[d]||(j[d]=a),c},terminate:function(){k=!0;for(var a=0;a<l.length;a++){var b=l[a];b.terminate()}return c},restore:function(){return k=!1,c}}}function e(){return{serialize:function(a){var b=function(a,b){for(var d=0;d<b.childNodes.length;d++)a[d]=c(b.childNodes[d])},c=function(a){var c={tag:a.localName||(a.nodeName||"").toLowerCase(),attributes:function(){for(var b=0,c={};a.attributes&&b<a.attributes.length;b++)c[a.attributes[b].name]=a.attributes[b].value;return c}(),"class":function(){for(var b=0,c=[];a.classList&&b<a.classList.length;b++)c[b]=a.classList[b];return c}(),value:a.nodeValue?a.nodeValue.trim():"",id:a.id};return b(c.child=[],a),c};return c(a)},deserialize:function(a){var c=function(a){switch(["#text","#comment"].indexOf(a.tag)){case 0:return b.createTextNode(a.value);case 1:return b.createComment(a.value);default:for(var c=0,d=b.createElement(a.tag),e=Object.keys(a.attributes);c<e.length;c++)d.setAttribute(e[c],a.attributes[e[c]]);return d}},d=function(a,b){for(var c=0;a&&a.child&&c<a.child.length;c++)b.appendChild(e(a.child[c],b))},e=function(a,b){var b=c(a);return d(a,b),b};return e(a)},diff:function(a,b){var c=[],d=function(a,b){if(void 0==a&&void 0==b)return!1;if(a instanceof Array&&b instanceof Array){for(var c=0;c<(a.length>b.length?a.length:b.length);c++){var d=a[c],e=b[c];d&&e&&("string"==typeof d&&"string"==typeof e?e!=d&&(e=d):"object"==typeof d&&"object"==typeof e||d instanceof Array&&e instanceof Array)}return!1}return"object"==typeof a&&"object"==typeof b?!1:!1},e=function(a,b,c,e){var f={};if(a&&!b)f.type="remove",f.row=c,f.col=e;else if(!a&&b)f.type="add",f.row=c,f.col=e,f.obj=b;else if(a&&b){for(var g=0,h=Object.keys(b),i=!1;!i&&g<h.length;g++){var j=b[h[g]],k=a[h[g]];i||(i=d(k,j)),console.log(h[g],i)}console.log("--------------------------------------")}},f=function(a,b,c){for(var d=0;d<function(){var c=((a?a.child:[])||[]).length||0,d=((b?b.child:[])||[]).length||0;return c>d?c:d}();d++){var e=((a?a.child:[])||[])[d],f=((b?b.child:[])||[])[d];g(e,f,c+1,d)}},g=function(a,b,c,d){e(a,b,c,d),f(a,b,c)};return g(a,b,0,0),c},patch:function(){}}}function f(b){if(!a.URL&&!a.webkitURL||!a.Blob||!a.Worker)return null;var c,d=/function([\s]+|)\(([\w|\s]+|)\)([\s]+|)\{([\w.|\s.|\S.]+)\}(\;|)/g.exec(String(b)),e=function(){return d.length<5?null:new a.Worker((a.URL||a.webkitURL).createObjectURL(new a.Blob([d[4]])))}();return c={onmessage:function(a){return e.onmessage=function(b){a.apply(this,[b.data])},c},emit:function(a){return e.postMessage(a),c},terminate:function(){return e.terminate()}}}function g(a){return{on:function(b,c){a.addEventListener(b,function(a){c(a.detail)})},emit:function(b,c){a.dispatchEvent(new CustomEvent(b,{detail:c}))},echo:function(a,c){b.addEventListener(a,function(a){c(a.detail)})},yell:function(a,c){b.dispatchEvent(new CustomEvent(a,{detail:c}))}}}function h(){var b="localStorage"in a&&null!==a.localStorage&&"undefined"!=typeof Storage;return{get:function(c){return b?a.localStorage.getItem(c):null},set:function(c,d){return b?a.localStorage.setItem(c,d):!1}}}function i(){var b="sessionStorage"in a&&null!==a.sessionStorage&&"undefined"!=typeof Storage;return{get:function(c){return b?a.sessionStorage.getItem(c):null},set:function(c,d){return b?a.sessionStorage.setItem(c,d):!1}}}function j(){a.Promise||!function(){function b(a,b){return function(){a.apply(b,arguments)}}function c(a){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(a,b(e,this),b(f,this))}function d(a){var b=this;return null===this._state?void this._deferreds.push(a):void j(function(){var c=b._state?a.onFulfilled:a.onRejected;if(null===c)return void(b._state?a.resolve:a.reject)(b._value);var d;try{d=c(b._value)}catch(e){return void a.reject(e)}a.resolve(d)})}function e(a){try{if(a===this)throw new TypeError("A promise cannot be resolved with itself.");if(a&&("object"==typeof a||"function"==typeof a)){var c=a.then;if("function"==typeof c)return void i(b(c,a),b(e,this),b(f,this))}this._state=!0,this._value=a,g.call(this)}catch(d){f.call(this,d)}}function f(a){this._state=!1,this._value=a,g.call(this)}function g(){for(var a=0,b=this._deferreds.length;b>a;a++)d.call(this,this._deferreds[a]);this._deferreds=null}function h(a,b,c,d){this.onFulfilled="function"==typeof a?a:null,this.onRejected="function"==typeof b?b:null,this.resolve=c,this.reject=d}function i(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}var j=a.setImmediate||function(a){setTimeout(a,1)},k=Array.isArray||function(a){return"[object Array]"===Object.prototype.toString.call(a)};c.prototype["catch"]=function(a){return this.then(null,a)},c.prototype.then=function(a,b){var e=this;return new c(function(c,f){d.call(e,new h(a,b,c,f))})},c.all=function(){var a=Array.prototype.slice.call(1===arguments.length&&k(arguments[0])?arguments[0]:arguments);return new c(function(b,c){function d(f,g){try{if(g&&("object"==typeof g||"function"==typeof g)){var h=g.then;if("function"==typeof h)return void h.call(g,function(a){d(f,a)},c)}a[f]=g,0===--e&&b(a)}catch(i){c(i)}}if(0===a.length)return b([]);for(var e=a.length,f=0;f<a.length;f++)d(f,a[f])})},c.resolve=function(a){return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)})},c.reject=function(a){return new c(function(b,c){c(a)})},c.race=function(a){return new c(function(b,c){for(var d=0,e=a.length;e>d;d++)a[d].then(b,c)})}}()}function k(){if(!Object.observe){var a=function(a,b,c){var d=a[b],e=d,f=function(){return e},g=function(f){return d=e,d!==f&&c([{type:"update",object:a,name:b,oldValue:d}]),e=f};delete a[b]&&Object.defineProperty(a,b,{get:f,set:g,enumerable:!0,configurable:!0})},b=function(a,b){var c=a[b];delete a[b],a[b]=c},c=function(a,b,c){Object.defineProperty(a,"__interval__",{enumerable:!1,configurable:!0,writeable:!1,value:setInterval(c,b)})},d=function(a){clearInterval(a.__interval__),delete a.__interval__},e=function(a,b){if(!(a instanceof Array&&b instanceof Array))throw new TypeError("#compare accepts two parameters, both being Arrays.");if(a.length!==b.length)return!1;for(var c=0,d=a.length;d>c;c++)if(a[c]instanceof Array&&b[c]instanceof Array){if(!e(a[c],b[c]))return!1}else if(a[c]!==b[c])return!1;return!0},f=function(a,b){if(!(a&&b&&a instanceof Array&&b instanceof Array))throw new TypeError("#diff accepts two parameters, both being Arrays.");var c=[],d={},e=a.length,f=b.length;d.added=[],d.deleted=[],d.all=[];for(var g=0;e>g;g++)c[a[g]]=1;for(var h=0;f>h;h++)c[b[h]]?delete c[b[h]]:c[b[h]]=2;for(var i in c)d.all.push(i),1===c[i]?d.deleted.push(i):d.added.push(i);return d},g=function(a){var b=[];for(var c in a)b.push(c);return b};Object.defineProperty(Object.prototype,"observe",{enumerable:!1,configurable:!0,writeable:!1,value:function(b,d){function h(){e(i,g(b))||(h(f(i,g(b)),b,d),i=g(b))}for(var i=g(b),j=i.length,k=0;j>k;k++)a(b,i[k],d);c(b,50,h)}}),Object.defineProperty(Object.prototype,"unobserve",{enumerable:!1,configurable:!0,writeable:!1,value:function(a){if(!a.__interval__)return!1;for(var c=Object.keys(a),e=c.length,f=0;e>f;f++)b(a,c[f]);d(a)}})}Object.observable||Object.defineProperty(Object.prototype,"observable",{enumerable:!1,configurable:!0,writeable:!1,value:function(a,b){Object.observe(a,function(c){for(var d=0;d<c.length;d++){var e=c[d];"add"==e.type&&(a[e.name]instanceof Array?Object.observable(a[e.name],b):"object"==typeof a[e.name]&&Object.observable(a[e.name],b))}b.apply(this,arguments)});for(var c=0,d=Object.keys(a);c<d.length;c++){var e=a[d[c]];e instanceof Array?Object.observable(e,b):"object"==typeof e&&Object.observable(e,b)}}}),Object.modulesync||Object.defineProperty(Object.prototype,"modulesync",{enumerable:!1,configurable:!0,writeable:!1,value:function(a,b,c){Object.observable(b,function(b){c.apply(this,[a,b])})}})}function l(){a.setImmediate||!function(){function b(a){return n[m]=c.apply(void 0,a),m++}function c(a){var b=[].slice.call(arguments,1);return function(){"function"==typeof a?a.apply(void 0,b):new Function(""+a)()}}function d(a){if(o)setTimeout(c(d,a),0);else{var b=n[a];if(b){o=!0;try{b()}finally{e(a),o=!1}}}}function e(a){delete n[a]}function f(){l=function(){var a=b(arguments);return process.nextTick(c(d,a)),a}}function g(){if(a.postMessage&&!a.importScripts){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}function h(){var c="setImmediate$"+Math.random()+"$",e=function(b){b.source===a&&"string"==typeof b.data&&0===b.data.indexOf(c)&&d(+b.data.slice(c.length))};a.addEventListener?a.addEventListener("message",e,!1):a.attachEvent("onmessage",e),l=function(){var d=b(arguments);return a.postMessage(c+d,"*"),d}}function i(){var a=new MessageChannel;a.port1.onmessage=function(a){var b=a.data;d(b)},l=function(){var c=b(arguments);return a.port2.postMessage(c),c}}function j(){var a=p.documentElement;l=function(){var c=b(arguments),e=p.createElement("script");return e.onreadystatechange=function(){d(c),e.onreadystatechange=null,a.removeChild(e),e=null},a.appendChild(e),c}}function k(){l=function(){var a=b(arguments);return setTimeout(c(d,a),0),a}}var l,m=1,n={},o=!1,p=a.document;"[object process]"==={}.toString.call(a.process)?f():g()?h():a.MessageChannel?i():p&&"onreadystatechange"in p.createElement("script")?j():k(),Window.prototype.setImmediate=l,Window.prototype.clearImmediate=e}()}function m(a,b,c){for(var d=b.cloneNode(!0),e=d.childNodes,f=a.childNodes,g=0;g<e.length;g++)for(var h=e[g],i=f[g],j=h.textContent.trim(),k=j.match(/\{\{([\w.|\s.|\'\"\[\]]+|)\}\}/g),l=0;null!=k&&l<k.length;l++){var m=k[l].substr(2,k[l].length-4).split("|")[0].trim(),o=function(){for(var a=0,b=m.match(/(\[(\'|\"|)([\w.\s.]+)(\'|\"|)\]|(\.[\w|\s]+))/g),d=m,e=[];null!=b&&a<b.length;a++){var f=/(\[(\'|\"|)([\w.\s.]+)(\'|\"|)\]|(\.[\w|\s]+))/g.exec(b[a]);e[a]="."==f[0].substr(0,1)?f[0].substr(1,f[0].length):f[3],d=d.replace(b[a],"")}for(var g=0,h=c[d];g<e.length;g++)h=h[e[g]];return h}(),p=function(){var a=k[l].substr(2,k[l].length-4).split("|")[1];return a&&"string"==typeof a?a.trim():null}();void 0!=o&&(i.textContent=h.textContent.replace(/\{\{([\w.|\s.|\'\"\[\]]+|)\}\}/g,p&&s.filter[p]&&s.filter[p].func?function(){return s.filter[p].func.apply(this,q(s.filter[p]))(o)}():o))}n(a,c)}function n(a,c){var d=0,e=a.querySelectorAll("[sync]");for(a.attributes.component.value;d<e.length;d++){var f=e[d],g=f.attributes.sync.value,h=function(){for(var a=0,b=g.match(/(\[(\'|\"|)([\w.\s.]+)(\'|\"|)\]|(\.[\w|\s]+))/g),d=g,e=[];null!=b&&a<b.length;a++){var f=/(\[(\'|\"|)([\w.\s.]+)(\'|\"|)\]|(\.[\w|\s]+))/g.exec(b[a]);e[a]="."==f[0].substr(0,1)?f[0].substr(1,f[0].length):f[3],d=d.replace(b[a],"")}for(var h=0,i=c[d];h<e.length;h++)i=i[e[h]];return i}();if(f.value!=h&&f.type&&~["text","password","search"].indexOf(f.type)){var i=f.selectionStart,j=f.selectionEnd;f.value=h,f==b.activeElement&&f.setSelectionRange(i,j)}o(f)}}function o(a){~s.event.indexOf(a)||(a.addEventListener("input",p,!1),a.addEventListener("change",p,!1),s.event.push(a))}function p(){var a=this,b=a.attributes.sync.value,c=a.value,d=function(){for(var b=a.parentNode;!b.attributes.component;)b=b.parentNode;return b.attributes.component.value}();!function(){for(var a=0,e=b.split("."),f=s.modules[d];a<e.length-1;a++)f=f[e[a]];f[e[e.length-1]]=c}()}function q(a){return a.libs&&a.libs.length>0?function(){for(var b=[],c=0;c<a.libs.length;c++){var e=a.libs[c];b[c]="root"==e?s.store:"module"==e?s.modules[a.name]||(s.modules[a.name]={}):"http"==e?d():"emitter"==e?g(s.rdom[a.name]):"webworker"==e?f:"persistentstorage"==e?h():"sessionstorage"==e?i():s.registry[e]?s.registry[e]["interface"]:null}return~b.indexOf(s.modules[a.name])||(b[b.length]=s.modules[a.name]||(s.modules[a.name]={})),b}():[s.modules[a.name]||(s.modules[a.name]={})]}function r(){for(var a,b,c,d=0;d<arguments.length;d++)"string"==typeof arguments[d]?a=arguments[d]:"function"==typeof arguments[d]?b=arguments[d]:arguments[d]instanceof Array&&(c=arguments[d]);if(a&&(b||c)){if(c&&c instanceof Array){for(var b,e=[],d=0;d<c.length;d++)"string"==typeof c[d]?e.push(c[d]):"function"==typeof c[d]&&(b=c[d]);return{name:a,libs:e,func:b}}if(b&&"function"==typeof b)return{name:a,func:b}}return void 0}j(),k(),l();var s={event:[],vdom:{},rdom:{},virtdom:{},registry:{},store:{},queue:{},modules:{},component:{},filter:{},directive:{},$:{}};return s.$.name="storyair-js",s.$.version="1.0.0a",a.onload=c,s.$.component=function(){var a=r.apply(this,arguments);return s.component[a.name]=a,s.$},s.$.filter=function(){var a=r.apply(this,arguments);return s.filter[a.name]=a,s.$},s.$.service=function(){var a=r.apply(this,arguments),b=a.func.apply(this,q(a));return b["interface"]&&!s.registry[a.name]&&("object"!=typeof b["interface"]?console.error("interface type must be an object."):(s.registry[a.name]=b,b.ready&&b.ready.apply(this))),s.$},s.$.directive=function(){},s.$.route=function(){},s.$.view=function(){},s.$.html=function(){},s.$.extend=function(){},a.Storyair=a.storyair=a.s=s.$}(window,document),function(){var a={kitId:"rhk3rvc"},b=document.createElement("script");b.src="//use.typekit.com/"+a.kitId+".js",b.type="text/javascript",b.async="true",b.onload=b.onreadystatechange=function(){var b=this.readyState;if(!b||"complete"==b||"loaded"==b)try{Typekit.load(a)}catch(c){}};var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}(),function(a){a.storyair.component("header",["module",function(){var b=50,c=function(){var a=document.body.scrollTop<b?"nav-visible":"nav-hidden";document.body.className!=a&&(document.body.className=a)};a.onscroll=c,c()}])}(window||this);